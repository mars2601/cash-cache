!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){"use strict";var b=a("jquery"),c=a("fastclick"),d=a("./router");window.app.now=new Date,b(function(){c(document.body),console.log(window.app),console.log("ready."),window.app.router=new d,window.app.router.start()})},{"./router":4,fastclick:"fastclick",jquery:"jquery"}],2:[function(a,b){"use strict";var c=(a("underscore"),a("backbone"));c.$=a("jquery"),b.exports=c.Collection.extend({url:"/api/terminals",model:a("../models/terminal"),parse:function(a){return a.data}})},{"../models/terminal":3,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],3:[function(a,b){"use strict";var c=(a("underscore"),a("backbone"));c.$=a("jquery"),b.exports=c.Model.extend({urlRoot:"/api/terminals",parse:function(a){return a.data&&a.url?a.data:a}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],4:[function(a,b){"use strict";var c=(a("underscore"),a("backbone")),d=a("jeolok");c.$=a("jquery");var e,f,g=a("./views/main"),h=a("./views/header"),i=a("./collections/terminals"),j=a("./models/terminal"),k=a("./views/terminals-list"),l=a("./views/terminal-details"),m=a("./views/terminals-map"),m=a("./views/terminals-map");b.exports=c.Router.extend({views:{},routes:{"terminals/list":"showTerminalsList","terminals/map":"showTerminalsMap","terminals/details/:id":"showTerminalDetails","":"showTerminalsList"},start:function(){console.log("Router:started"),(this.views.main=new g).render(),this.views.main.initHeader((this.views.header=new h).render()),d.getCurrentPosition({enableHighAccuracy:!0,timeout:11500},function(a,b){e=a||!b?{latitude:50.84275,longitude:4.35154}:b.coords,window.app.currentPosition=e,c.history.start({pushState:!0})})},showTerminalsList:function(){console.log("showTerminalsList");var a=this;this.views.main.loading(!0);var b=new i;(this.views.list=new k(b)).collection.fetch({data:{latitude:e.latitude,longitude:e.longitude},success:function(){a.views.main.clearContent(),a.views.main.initList(a.views.list.render(f,e)),a.views.main.loading(!1,b.length+" résultats")}})},showTerminalsMap:function(){console.log("showTerminalsMap");var a=this;this.views.main.loading(!0);var b=new i;(this.views.map=new m(b,f,e)).collection.fetch({data:{latitude:e.latitude,longitude:e.longitude},success:function(){a.views.main.clearContent(),a.views.main.initMap(a.views.map.render(f,e)),a.views.main.loading(!1,b.length+" résultats")}})},showTerminalDetails:function(a){console.log("showTerminalDetails:",a);var b=this;this.views.main.loading(!0);var c=new j({id:a});(this.views.details=new l(c,f,e)).model.fetch({success:function(){b.views.main.clearContent(),b.views.main.initDetails(b.views.details.render(f,e)),b.views.main.loading(!1)}})}})},{"./collections/terminals":2,"./models/terminal":3,"./views/header":5,"./views/main":6,"./views/terminal-details":8,"./views/terminals-list":10,"./views/terminals-map":12,backbone:"backbone",jeolok:"jeolok",jquery:"jquery",underscore:"underscore"}],5:[function(a,b){"use strict";var c=(a("underscore"),a("backbone")),d=a("jquery");c.$=a("jquery");var e;b.exports=c.View.extend({el:"<div />",constructor:function(){c.View.apply(this,arguments),console.log("HeaderView:init()"),e||(e=d("#tpl-header").remove().text())},events:{"click #reload":"reloadButtonClicked","click #back":"backButtonClicked","click #problems":"problemsButtonClicked"},render:function(){return this.$el.html(e),this.$status=this.$el.find("#status h3"),this},loading:function(a){this.$el.find("#status").toggleClass("loading",a)},getStatus:function(){return this.$status.text()},setStatus:function(a){this.$status.text(a)},reloadButtonClicked:function(a){a.preventDefault(),console.log("reloadButtonClicked")},backButtonClicked:function(a){a.preventDefault(),console.log("backButtonClicked"),window.app.router.navigate("terminals/list",{trigger:!0})},problemsButtonClicked:function(a){a.preventDefault(),console.log("problemsButtonClicked"),d("#delete_terminal").length?(d(".problems").hide(),d(".problems").children("a").remove()):d(".problems").append('<a href="#" id="delete_terminal">Pas de distributeur ici</a>').append('<a href="#" id="wrong_place_terminal">Mauvaise place sur la carte</a>').append('<a href="#" id="wrong_bank_terminal">Mauvaise banque</a>').append('<a href="#" id="double_terminal">Distributeur en double</a>').fadeIn().end()}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],6:[function(a,b){"use strict";var c=(a("underscore"),a("backbone")),d=a("jquery");c.$=a("jquery"),b.exports=c.View.extend({el:"body",$el:d("body"),constructor:function(){c.View.apply(this,arguments),console.log("MainView:init()")},loading:function(a,b){a?(this._status=window.app.router.views.header.getStatus(),window.app.router.views.header.loading(!0),window.app.router.views.header.setStatus(b||"chargement...")):(window.app.router.views.header.loading(!1),window.app.router.views.header.setStatus(b))},initHeader:function(a){this.$el.find("#main").append(a.$el)},clearContent:function(){this.$el.find("#main section:not(#status)").remove()},initList:function(a){this.$el.find("#main").append(a.$el)},initMap:function(a){this.$el.find("#main").append(a.$el)},initDetails:function(a){this.$el.find("#main").append(a.$el)}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],7:[function(){},{}],8:[function(a,b){"use strict";var c=(a("underscore"),a("backbone")),d=a("jquery"),e=a("jeyo-distans");c.$=a("jquery");var f,g,h,i,j,k,l=[],m=[];b.exports=c.View.extend({el:"<section />",constructor:function(a){c.View.apply(this,arguments),this.model=a,console.log("TerminalDetailsView:init()"),f||(f=d("#tpl-details").remove().text())},events:{"click .problems a#empty_terminal":"toggleEmptyState","click .problems a#delete_terminal":"deleteTerminal","click .problems a#wrong_place_terminal":"wrongPlaceTerminal","click .problems a#wrong_bank_terminal":"wrongBankTerminal","click .problems a#double_terminal":"doubleTerminal"},render:function(a,b){function c(b,c){var d=new google.maps.Marker({position:b,map:a,title:"My position",icon:c});l.push(d)}i={latitude:b.latitude,longitude:b.longitude},k=this.model.get("bank");var h={latitude:this.model.get("latitude"),longitude:this.model.get("longitude")},j=new google.maps.LatLngBounds;m=[],m.push(new google.maps.LatLng(h.latitude,h.longitude)),m.push(new google.maps.LatLng(i.latitude,i.longitude)),g={center:{lat:h.latitude,lng:h.longitude},zoom:16,mapTypeControl:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,scaleControl:!0,styles:[{featureType:"landscape",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",stylers:[{saturation:-100},{lightness:51},{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"road.arterial",stylers:[{saturation:-100},{lightness:30},{visibility:"on"}]},{featureType:"road.local",stylers:[{saturation:-100},{lightness:40},{visibility:"on"}]},{featureType:"transit",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"on"},{lightness:-25},{saturation:-100}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]}]},a=new google.maps.Map(document.getElementById("gmap"),g);for(var n=0;n<m.length;n++)j.extend(m[n]);a.fitBounds(j),a.setZoom(a.getZoom()-1);var o="../../images/markers/me-marker.png",p=new google.maps.LatLng(i.latitude,i.longitude);c(p,o);var q="../../images/markers/terminal-marker.png",r=new google.maps.LatLng(h.latitude,h.longitude);c(r,q);var h={latitude:this.model.get("latitude"),longitude:this.model.get("longitude")};return d(document).find(".status").css("display","none").end(),d("#gmap").removeAttr("class").end(),d("#header").find("#back").css("display","block").end(),d("#header").find("#problems").css("display","block").end(),this.$el.html(f).attr("id","details").show().find("h3").find("img").attr("src",k&&k.icon?"/images/banks/"+k.icon:"images/banks/unknown.png").attr("alt",k&&k.name?k.name:"Inconnu").end().find("span").css("color","#"+(k&&k.color?k.color:"333")).text(k&&k.name?k.name:"Inconnu").end().end().find("address").text(this.model.get("address")).end().find(".empty").toggle(this.model.get("empty")).end().find(".infos").css("position","relative").css("right","auto").css("top","auto").css("bottom","0").css("text-align","right").find("> span").text(1e3*e(h,window.app.currentPosition)+"m").end().end().find(".problems").toggle(!this.model.get("empty")).css("display","none").end().find(".confirm_problem").hide(),this},toggleEmptyState:function(a){a.preventDefault();var b=this;this.model.set("empty",!1),console.log(this.model),this.model.save(null,{url:"/api/terminals/"+this.model.get("id")+"/empty",success:function(){b.$el.find("empty").show().end().find(".problems").hide()}})},deleteTerminal:function(){console.log("deleteTerminal")},wrongPlaceTerminal:function(){function a(a,b){var c=new google.maps.Marker({position:a,map:h,title:"My position",icon:b});l.push(c)}function b(a){for(var b=1;b<l.length;b++)l[b].setMap(a)}function c(){b(null)}console.log("wrongPlaceTerminal"),d(".problems").find("a").css("display","none").end().append('<p class="define_new_place">Clickez sur la carte pour positionner la banque.'),h=new google.maps.Map(document.getElementById("gmap"),g);for(var e=new google.maps.LatLngBounds,f=0;f<m.length;f++)e.extend(m[f]);h.fitBounds(e),h.setZoom(h.getZoom()-1);var k="../../images/markers/me-marker.png",n=new google.maps.LatLng(i.latitude,i.longitude);a(n,k);var o;o=this.model,google.maps.event.addListener(h,"click",function(b){var e="../../images/markers/terminal-marker.png";c(),a(n,"../../images/markers/me-marker.png"),a(b.latLng,e),j=b.latLng,d("#confirm-button").length||(d("#demo").append('<a href="#" id="confirm-button" >Confirmer la nouvelle localisation</a>'),d("#confirm-button").click(function(){o.set("latitude",j.D),o.set("longitude",j.k),console.log(o),o.save(null,{url:"/api/terminals/"+o.get("id")+"/reposition",success:function(){d(".problems").hide()},error:function(){console.log("aie")}})}))})},wrongBankTerminal:function(){console.log("wrongBankTerminal")},doubleTerminal:function(){console.log("doubleTerminal")}})},{backbone:"backbone","jeyo-distans":"jeyo-distans",jquery:"jquery",underscore:"underscore"}],9:[function(a,b){"use strict";var c=(a("underscore"),a("backbone")),d=a("jquery");c.$=a("jquery");var e;b.exports=c.View.extend({el:"<li />",constructor:function(a){c.View.apply(this,arguments),this.model=a,e||(e=d("#tpl-result-list-elt").remove().text())},events:{"click a":"showTerminal"},render:function(){var a=this.model.get("bank");return this.$el.html(e).find("a").css("border-left","solid 6px #"+(a&&a.color?a.color:"333")).end().find("img").attr("src",a&&a.icon?"/images/banks/"+a.icon:"images/banks/unknown.png").attr("alt",a&&a.name?a.name:"Inconnu").end().find("strong").css("color","#"+(a&&a.color?a.color:"333")).text(a&&a.name?a.name:"Inconnu").end().find("span").text(1e3*parseFloat(this.model.get("distance"))+"m"),this},showTerminal:function(a){a.preventDefault(),window.app.router.navigate("terminals/details/"+this.model.get("id"),{trigger:!0})}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],10:[function(a,b){"use strict";var c=(a("underscore"),a("backbone")),d=a("jquery");c.$=a("jquery");{var e,f=a("./terminals-list-element");a("./map")}b.exports=c.View.extend({el:"<section />",constructor:function(a){c.View.apply(this,arguments),this.collection=a,console.log("TerminalsListView:init()"),e||(e=d("#tpl-result-list").remove().text())},events:{"click a#see-all":"showMap"},render:function(a,b){var c={center:{lat:b.latitude,lng:b.longitude},zoom:16,mapTypeControl:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,scaleControl:!0,styles:[{featureType:"landscape",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",stylers:[{saturation:-100},{lightness:51},{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"road.arterial",stylers:[{saturation:-100},{lightness:30},{visibility:"on"}]},{featureType:"road.local",stylers:[{saturation:-100},{lightness:40},{visibility:"on"}]},{featureType:"transit",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"on"},{lightness:-25},{saturation:-100}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]}]};a=new google.maps.Map(document.getElementById("gmap"),c),d("#header").find("#back").css("display","none").end(),d("#gmap").attr("class","blured").end(),d("#header").find("#problems").css("display","none").end(),this.$el.attr("id","result").html(e).find("#see-all").css("display","block");var g=this.$el.find("ul");return this.collection.each(function(a){new f(a).render().$el.appendTo(g)}),this},showMap:function(a){console.log("showMapClick"),a.preventDefault(),window.app.router.navigate("terminals/map",{trigger:!0})}})},{"./map":7,"./terminals-list-element":9,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],11:[function(a,b){"use strict";{var c=(a("underscore"),a("backbone")),d=a("jquery");a("jeyo-distans")}c.$=a("jquery");var e;b.exports=c.View.extend({el:"<section />",constructor:function(a){c.View.apply(this,arguments),this.model=a,e||(e=d("#tpl-map-elt").remove().text())},render:function(a,b,c){function d(b,d){var f=new google.maps.Marker({position:b,map:a,title:"My position",icon:d});google.maps.event.addListener(f,"click",function(){window.app.router.navigate("terminals/details/"+e,{trigger:!0})}),c.push(f)}var e=(this.model.get("bank"),this.model.get("id")),f={latitude:this.model.get("latitude"),longitude:this.model.get("longitude")};b.push(new google.maps.LatLng(f.latitude,f.longitude));var g=new google.maps.LatLngBounds,h="../images/markers/terminal-marker.png",i=new google.maps.LatLng(f.latitude,f.longitude);d(i,h);for(var j=0;j<b.length;j++)g.extend(b[j]);return a.fitBounds(g),a.setZoom(a.getZoom()-1),this},toggleEmptyState:function(a){a.preventDefault();var b=this;this.model.set("empty",!1),this.model.save(null,{url:"/api/terminals/"+this.model.get("id")+"/empty",success:function(){b.$el.find("empty").show().end().find(".problems").hide()}})}})},{backbone:"backbone","jeyo-distans":"jeyo-distans",jquery:"jquery",underscore:"underscore"}],12:[function(a,b){"use strict";{var c=(a("underscore"),a("backbone")),d=a("jquery");a("jeyo-distans")}c.$=a("jquery");var e,f=a("./terminals-map-element"),g=[],h=[];b.exports=c.View.extend({el:"<section />",constructor:function(a){c.View.apply(this,arguments),this.collection=a,console.log("TerminalsMapView:init()"),e||(e=d("#tpl-map").remove().text())},events:{},render:function(a,b){function c(b,c){var d=new google.maps.Marker({position:b,map:a,title:"My position",icon:c});h.push(d)}d("#header").find("#back").css("display","block").end(),d("#header").find("#problems").css("display","none").end(),d(document).find(".status").css("display","block").end(),d("#gmap").removeAttr("class").end();var e={latitude:b.latitude,longitude:b.longitude},i={center:{lat:e.latitude,lng:e.longitude},zoom:16,mapTypeControl:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,scaleControl:!0,styles:[{featureType:"landscape",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",stylers:[{saturation:-100},{lightness:51},{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"road.arterial",stylers:[{saturation:-100},{lightness:30},{visibility:"on"}]},{featureType:"road.local",stylers:[{saturation:-100},{lightness:40},{visibility:"on"}]},{featureType:"transit",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"on"},{lightness:-25},{saturation:-100}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]}]};a=new google.maps.Map(document.getElementById("gmap"),i);var j="../images/markers/me-marker.png",k=new google.maps.LatLng(e.latitude,e.longitude);return c(k,j),g.push(new google.maps.LatLng(e.latitude,e.longitude)),this.collection.each(function(b){new f(b).render(a,g,h)}),this},toggleEmptyState:function(a){a.preventDefault();var b=this;this.model.set("empty",!1),this.model.save(null,{url:"/api/terminals/"+this.model.get("id")+"/empty",success:function(){b.$el.find("empty").show().end().find(".problems").hide()}})}})},{"./terminals-map-element":11,backbone:"backbone","jeyo-distans":"jeyo-distans",jquery:"jquery",underscore:"underscore"}]},{},[1]);
//# sourceMappingURL=app.min.js.map